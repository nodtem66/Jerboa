Jerboa.register("TextMenu",function(e){var a=e.lib,f,g;this.enable=true;this.execute=function(d){var b={"forecolor":true,"backcolor":true},h={"justifyleft":true,"justifycenter":true,"justifyright":true,"justifyfull":true},i={"clear":true,"transparent":true,"remove":true,"clearcolor":true,"removecolor":true},c=null;if(h[d]==true){if(!document.execCommand(d,false,c))a.addStyle(Jerboa.currentEditElement,{"text-align":d.replace(/justify/ig,"").replace(/full/ig,"justify")});return false}if(b[d]==true){c=prompt("Insert RGB color","000000");if(i[c]==true||(c.length!=3&&c.length!=6)){c="transparent"}else if(a.env.firefox||a.env.webkit)c="#"+c}document.execCommand(d,false,c)}this.init=function(){var b=null;f=e.addPanel("textmenu");g=f.getElement();b=a.setNode();b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"outdent")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"indent")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"insertunorderedlist")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"insertorderedlist")}}));g.appendChild(b);b=a.setNode();b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"forecolor")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"backcolor")}}));b.appendChild(a.setNode({tag:"button",html:"<b>B</b>",event:{add:"click",fn:a.curry(this.execute,this,0,"bold")}}));b.appendChild(a.setNode({tag:"button",html:"<i>I</i>",event:{add:"click",fn:a.curry(this.execute,this,0,"italic")}}));b.appendChild(a.setNode({tag:"button",html:"<u>U</u>",event:{add:"click",fn:a.curry(this.execute,this,0,"underline")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"justifyleft")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"justifycenter")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"justifyright")}}));b.appendChild(a.setNode({tag:"button",html:"<span></span>",event:{add:"click",fn:a.curry(this.execute,this,0,"justifyfull")}}));g.appendChild(b);e.listen("textedit",function(){if(this.enable)f.show()},this);e.listen("restorestate",function(){f.hide()},this);e.listen("click-flipswitch-TextMenu",function(d){this.enable=d.data},this)}this.destroy=function(){}});